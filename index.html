<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Caixa Pro 2026 - Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #listaRegistros::-webkit-scrollbar {
            width: 0px;
        }

        .hidden {
            display: none;
        }

        body {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans text-gray-900">

    <!-- TELA PRINCIPAL -->
    <div id="tela-principal" class="max-w-md mx-auto p-4 space-y-4">
        <div class="bg-blue-700 p-8 rounded-[2.5rem] text-white shadow-2xl shadow-blue-200 text-center">
            <p class="text-[10px] uppercase tracking-[0.2em] opacity-70 font-black mb-1">Saldo em Caixa</p>
            <h1 id="saldoTotal" class="text-4xl font-black italic tracking-tighter tabular-nums">R$ 0,00</h1>
        </div>

        <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100 space-y-4">
            <input type="text" id="desc" placeholder="Descri√ß√£o (ex: Venda ou Sangria)"
                class="w-full p-4 bg-gray-50 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 text-sm border-none">
            <input type="number" id="valor" placeholder="Valor R$ 0,00"
                class="w-full p-4 bg-gray-50 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 text-sm border-none font-bold">

            <select id="forma" onchange="toggleBandeira()"
                class="w-full p-4 bg-gray-50 rounded-2xl outline-none text-sm border-none font-bold text-gray-700">
                <option value="Dinheiro">üíµ Dinheiro</option>
                <option value="Pix">üíé PIX</option>
                <option value="Cart√£o">üí≥ Cart√£o</option>
            </select>

            <div id="divBandeira" class="hidden">
                <select id="bandeira"
                    class="w-full p-4 bg-blue-50 rounded-2xl outline-none border border-blue-100 text-sm font-black text-blue-600">
                    <option value="Visa">Visa</option>
                    <option value="Mastercard">Mastercard</option>
                    <option value="Elo">Elo</option>
                </select>
            </div>

            <div id="divTipoSaida" class="hidden space-y-2">
                <p class="text-[10px] font-black text-rose-500 uppercase ml-1 tracking-widest">Classificar Sa√≠da:</p>
                <div class="flex gap-2">
                    <button onclick="confirmarSalvar('saida', 'Sangria')"
                        class="flex-1 bg-rose-50 text-rose-600 py-3 rounded-xl font-black text-[10px] uppercase border border-rose-100">Sangria</button>
                    <button onclick="confirmarSalvar('saida', 'Despesa')"
                        class="flex-1 bg-orange-50 text-orange-600 py-3 rounded-xl font-black text-[10px] uppercase border border-orange-100">Despesa</button>
                </div>
            </div>

            <div id="botoesAcao" class="flex gap-3 pt-2">
                <button onclick="confirmarSalvar('entrada')"
                    class="flex-1 bg-emerald-500 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-all uppercase tracking-widest text-xs">Entrada</button>
                <button onclick="mostrarOpcoesSaida()"
                    class="flex-1 bg-rose-500 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-all uppercase tracking-widest text-xs">Sa√≠da</button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 text-center">
            <button onclick="abrirPagina('entrada')"
                class="bg-white py-4 rounded-2xl shadow-sm text-emerald-600 font-black border border-emerald-50 text-[10px] uppercase tracking-widest">üìã
                Ver Entradas</button>
            <button onclick="abrirPagina('saida')"
                class="bg-white py-4 rounded-2xl shadow-sm text-rose-600 font-black border border-rose-50 text-[10px] uppercase tracking-widest">üìã
                Ver Sa√≠das</button>
        </div>

        <div class="pt-6 space-y-3 flex flex-col items-center">
            <button onclick="baixarExcel()"
                class="text-[10px] font-black text-blue-600 hover:text-blue-700 uppercase tracking-[0.2em] flex items-center gap-2 border border-blue-100 px-6 py-3 rounded-full bg-blue-50">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                    stroke-linecap="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"></path>
                </svg>
                Salvar Relat√≥rio Excel
            </button>

            <button onclick="resetarTudo()"
                class="text-[9px] font-black text-gray-300 hover:text-rose-500 uppercase tracking-[0.3em] flex items-center gap-2">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                    stroke-linecap="round">
                    <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                    </path>
                </svg>
                Zerar para o novo dia
            </button>
        </div>
    </div>

    <!-- TELA DE RELAT√ìRIO -->
    <div id="tela-relatorio" class="hidden fixed inset-0 bg-white flex flex-col z-50">
        <div class="p-4 border-b border-gray-100">
            <div class="max-w-md mx-auto flex items-center justify-between mb-4">
                <button onclick="voltar()"
                    class="w-12 h-12 bg-white rounded-2xl shadow-lg flex items-center justify-center border border-gray-50">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="3"
                        stroke-linecap="round">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <div class="text-right">
                    <h2 id="tituloRelatorio" class="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em]">
                    </h2>
                    <div class="h-1 w-6 bg-blue-600 rounded-full ml-auto mt-1"></div>
                </div>
            </div>
            <div class="max-w-md mx-auto flex gap-2 bg-gray-100 p-1 rounded-xl">
                <button id="btnAtalhoEntrada" onclick="abrirPagina('entrada')"
                    class="flex-1 py-2 text-[10px] font-black uppercase rounded-lg">Entradas</button>
                <button id="btnAtalhoSaida" onclick="abrirPagina('saida')"
                    class="flex-1 py-2 text-[10px] font-black uppercase rounded-lg">Sa√≠das</button>
            </div>
        </div>
        <div id="listaRegistros" class="flex-1 overflow-y-auto px-4 max-w-md mx-auto w-full pb-32"></div>
        <div class="absolute bottom-0 left-0 right-0 p-6 bg-white/90 backdrop-blur-md border-t border-gray-100">
            <div class="max-w-md mx-auto flex justify-between items-center">
                <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest italic">Soma Total:</span>
                <span id="totalPagina" class="text-3xl font-black text-gray-900 tracking-tighter tabular-nums">R$
                    0,00</span>
            </div>
        </div>
    </div>

    <script>
        window.onload = () => atualizarSaldo();

        function toggleBandeira() {
            const forma = document.getElementById('forma').value;
            document.getElementById('divBandeira').classList.toggle('hidden', forma !== 'Cart√£o');
        }

        function mostrarOpcoesSaida() {
            if (!document.getElementById('desc').value || !document.getElementById('valor').value) return alert("Preencha os dados primeiro!");
            document.getElementById('botoesAcao').classList.add('hidden');
            document.getElementById('divTipoSaida').classList.remove('hidden');
        }

        function confirmarSalvar(tipo, subtipo = '') {
            const desc = document.getElementById('desc').value;
            const valor = parseFloat(document.getElementById('valor').value);
            const forma = document.getElementById('forma').value;
            const bandeira = forma === 'Cart√£o' ? document.getElementById('bandeira').value : '';
            if (!desc || isNaN(valor)) return alert("Preencha tudo!");

            const agora = new Date();
            const dataF = agora.toLocaleDateString('pt-BR') + ', ' + agora.toLocaleTimeString('pt-BR');
            const registro = { id: Date.now(), tipo, subtipo, desc, valor, forma, bandeira, data: dataF };
            const dados = JSON.parse(localStorage.getItem('fluxo_caixa')) || [];
            dados.push(registro);
            localStorage.setItem('fluxo_caixa', JSON.stringify(dados));

            document.getElementById('desc').value = '';
            document.getElementById('valor').value = '';
            document.getElementById('divTipoSaida').classList.add('hidden');
            document.getElementById('botoesAcao').classList.remove('hidden');
            atualizarSaldo();
            alert("‚úÖ Salvo!");
        }

        function atualizarSaldo() {
            const dados = JSON.parse(localStorage.getItem('fluxo_caixa')) || [];
            const saldo = dados.reduce((acc, i) => i.tipo === 'entrada' ? acc + i.valor : acc - i.valor, 0);
            document.getElementById('saldoTotal').innerText = `R$ ${saldo.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
        }

        function resetarTudo() {
            if (confirm("üö® ZERAR TUDO? Certifique-se de ter salvo o Excel antes!")) {
                localStorage.removeItem('fluxo_caixa');
                atualizarSaldo();
            }
        }

        function baixarExcel() {
            const dados = JSON.parse(localStorage.getItem('fluxo_caixa')) || [];
            if (dados.length === 0) return alert("Sem dados!");

            const entradas = dados.filter(i => i.tipo === 'entrada');
            const saidas = dados.filter(i => i.tipo === 'saida');
            const calcularT = (l) => l.reduce((acc, i) => acc + i.valor, 0);

            let html = `<meta charset="utf-8"><table>
                <tr><td colspan="6" style="background:#2563eb;color:white;font-weight:bold;text-align:center">ENTRADAS</td></tr>
                <tr style="background:#f1f5f9"><td>Data</td><td>Tipo</td><td>Descri√ß√£o</td><td>Forma</td><td>Bandeira</td><td>Valor</td></tr>
                ${entradas.map(i => `<tr><td>${i.data}</td><td>Venda</td><td>${i.desc}</td><td>${i.forma}</td><td>${i.bandeira || '-'}</td><td>${i.valor.toFixed(2).replace('.', ',')}</td></tr>`).join('')}
                <tr style="font-weight:bold;background:#e2e8f0"><td colspan="5">TOTAL ENTRADAS</td><td>${calcularT(entradas).toFixed(2).replace('.', ',')}</td></tr>
                <tr><td colspan="6"></td></tr>
                <tr><td colspan="6" style="background:#e11d48;color:white;font-weight:bold;text-align:center">SA√çDAS</td></tr>
                <tr style="background:#f1f5f9"><td>Data</td><td>Categoria</td><td>Descri√ß√£o</td><td>Forma</td><td>Bandeira</td><td>Valor</td></tr>
                ${saidas.map(i => `<tr><td>${i.data}</td><td>${i.subtipo}</td><td>${i.desc}</td><td>${i.forma}</td><td>-</td><td>${i.valor.toFixed(2).replace('.', ',')}</td></tr>`).join('')}
                <tr style="font-weight:bold;background:#e2e8f0"><td colspan="5">TOTAL SA√çDAS</td><td>${calcularT(saidas).toFixed(2).replace('.', ',')}</td></tr>
                <tr><td colspan="6"></td></tr>
                <tr style="background:#1e293b;color:white;font-weight:bold"><td colspan="5">SALDO L√çQUIDO DO DIA</td><td>${(calcularT(entradas) - calcularT(saidas)).toFixed(2).replace('.', ',')}</td></tr>
            </table>`;

            const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `Relatorio_Caixa_${new Date().toLocaleDateString().replace(/\//g, '-')}.xls`;
            a.click();
        }

        function abrirPagina(tipo) {
            document.getElementById('tela-principal').classList.add('hidden');
            document.getElementById('tela-relatorio').classList.remove('hidden');
            document.getElementById('tituloRelatorio').innerText = tipo === 'entrada' ? 'Extrato Entradas' : 'Extrato Sa√≠das';
            renderizarLista(tipo);
        }

        function renderizarLista(tipo) {
            const dados = JSON.parse(localStorage.getItem('fluxo_caixa')) || [];
            const filtrados = dados.filter(d => d.tipo === tipo);
            const container = document.getElementById('listaRegistros');
            let soma = 0;

            const btnE = document.getElementById('btnAtalhoEntrada');
            const btnS = document.getElementById('btnAtalhoSaida');
            btnE.className = `flex-1 py-2 text-[10px] font-black uppercase rounded-lg ${tipo === 'entrada' ? 'bg-white shadow-sm text-green-600' : 'text-gray-400'}`;
            btnS.className = `flex-1 py-2 text-[10px] font-black uppercase rounded-lg ${tipo === 'saida' ? 'bg-white shadow-sm text-red-600' : 'text-gray-400'}`;

            container.innerHTML = filtrados.length ? '' : '<p class="text-center text-gray-300 mt-20 font-black uppercase text-[10px]">Vazio</p>';

            filtrados.reverse().forEach(item => {
                soma += item.valor;
                const tag = item.subtipo ? `<span class="px-1.5 py-0.5 rounded text-[8px] font-black uppercase ${item.subtipo === 'Sangria' ? 'bg-red-50 text-red-500' : 'bg-orange-50 text-orange-500'} ml-2 border border-current">${item.subtipo}</span>` : '';
                container.innerHTML += `
                    <div class="flex items-center justify-between py-4 border-b border-gray-50 relative">
                        <div class="flex-1 pr-4">
                            <div class="flex items-center mb-1 text-[9px] text-gray-400 font-bold uppercase tracking-tighter">${item.data}${tag}</div>
                            <div class="flex items-center gap-2"><span class="text-[10px] font-black text-blue-500 uppercase">${item.forma}</span><p class="text-sm font-semibold text-gray-700 truncate max-w-[150px]">${item.desc}</p></div>
                        </div>
                        <div class="flex items-center gap-4"><span class="text-sm font-bold ${tipo === 'entrada' ? 'text-green-600' : 'text-red-600'}">R$ ${item.valor.toFixed(2)}</span>
                        <button onclick="excluirItem(${item.id}, '${tipo}')" class="text-red-100 hover:text-red-500 transition-colors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>
                    </div>`;
            });
            document.getElementById('totalPagina').innerText = `R$ ${soma.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
        }

        function excluirItem(id, tipo) {
            if (confirm("Apagar?")) {
                let d = JSON.parse(localStorage.getItem('fluxo_caixa')) || [];
                d = d.filter(i => i.id !== id);
                localStorage.setItem('fluxo_caixa', JSON.stringify(d));
                atualizarSaldo(); renderizarLista(tipo);
            }
        }

        function voltar() {
            document.getElementById('tela-relatorio').classList.add('hidden');
            document.getElementById('tela-principal').classList.remove('hidden');
        }
    </script>
</body>

</html>
